{
    "contents" : "library(survival)\nlibrary(ggplot2)\nsetwd(\"~/Dropbox/UT Biostat/CHL7001 Statistical Analysis of Health Economic Data/\")\ndt <- read.csv(\"./Data/Censored Cost data.csv\")\n### direct method ###\n# remove costs for those with incomplete cost data in each interval\ndt$Cost1[dt$FUtime < 0.5 & dt$cens == 1] <- NA\ndt$Cost2[dt$FUtime < 1 & dt$cens == 1] <- NA\ndt$Cost3[dt$FUtime < 1.5 & dt$cens == 1] <- NA\ndt$Cost4[dt$FUtime < 2] <- NA\n# calculate mean cost per interval for each treatment group\n## treatment group 0\ncost01 <- mean(dt$Cost1[dt$Cost1 != 0 & dt$Rx == 0], na.rm = TRUE)\ncost02 <- mean(dt$Cost2[dt$Cost2 != 0 & dt$Rx == 0], na.rm = TRUE)\ncost03 <- mean(dt$Cost3[dt$Cost3 != 0 & dt$Rx == 0], na.rm = TRUE)\ncost04 <- mean(dt$Cost1[dt$Cost4 != 0 & dt$Rx == 0], na.rm = TRUE)\n## treatment group 1\ncost11 <- mean(dt$Cost1[dt$Cost1 != 0 & dt$Rx == 1], na.rm = TRUE)\ncost12 <- mean(dt$Cost2[dt$Cost2 != 0 & dt$Rx == 1], na.rm = TRUE)\ncost13 <- mean(dt$Cost3[dt$Cost3 != 0 & dt$Rx == 1], na.rm = TRUE)\ncost14 <- mean(dt$Cost1[dt$Cost4 != 0 & dt$Rx == 1], na.rm = TRUE)\n# fit Kaplan-Meier survival curves\ns0 <- survfit(Surv(FUtime, 1 - cens) ~ 1, data = subset(dt, Rx == 0))\ns1 <- survfit(Surv(FUtime, 1 - cens) ~ 1, data = subset(dt, Rx == 1))\n\nsdf <- rbind(data.frame(time = s0$time, surv = s0$surv, upl = s0$upper, lwl = s0$lower, group = 0),\n             data.frame(time = s1$time, surv = s1$surv, upl = s1$upper, lwl = s1$lower, group = 1))\n\npng(\"Img/03surv.png\", width = 480, height = 480)\nggplot(data = sdf, aes(x = time)) +\n  theme_minimal() + labs(x = \"Time\", y = \"Survival\", title = \"Kaplan-Meier survival curve\") +\n  geom_step(aes(y = surv, color = factor(group), linetype = \"Estimate\")) +\n  geom_step(aes(y = upl, color = factor(group), linetype = \"95% confidence interval\")) +\n  geom_step(aes(y = lwl, color = factor(group), linetype = \"95% confidence interval\")) +\n  scale_linetype_manual(name = \"\", breaks = c(\"Estimate\", \"95% confidence interval\"),\n                 values = c(2, 1)) +\n  scale_color_discrete(name = \"Group\")\ndev.off()\n# calculate mean total costs for each treatment group and their difference\nc0 <- sum(c(cost01,\n            min(s0$surv[s0$time < 0.5])*cost02,\n            min(s0$surv[s0$time < 1])*cost03,\n            min(s0$surv[s0$time < 1.5])*cost04))\nc1 <- sum(c(cost11,\n            min(s1$surv[s1$time < 0.5])*cost12,\n            min(s1$surv[s1$time < 1])*cost13,\n            min(s1$surv[s1$time < 1.5])*cost14))\nc0 - c1\n\n### inverse probability weighting method ###\n",
    "created" : 1465412657701.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4113718067",
    "id" : "FF1BDABA",
    "lastKnownWriteTime" : 1465417653,
    "path" : "~/Dropbox/UT Biostat/CHL7001 Statistical Analysis of Health Economic Data/lecture03.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "type" : "r_source"
}